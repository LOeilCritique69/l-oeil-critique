<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Mini-jeu cin√©ma - Devine le film √† partir de l'affiche, avec diff√©rents niveaux de difficult√©.">
<title>Devine le Film - L'≈íil Critique</title>

<!-- Fonts + CSS -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/chef_d_oeuvre.css">
<style>
/* ========================================================================
   SECTION JEU ‚Äî Devine le Film
   ======================================================================== */

.page-intro-section {
  text-align: center;
  padding: 4rem 1.5rem 2rem;
  color: #f0f0f0;
}

.page-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 3rem;
  color: var(--secondary-color);
  letter-spacing: 1px;
}

.page-description {
  max-width: 650px;
  margin: 0.8rem auto 0;
  font-size: 1.05rem;
  color: #c7c7c7;
  line-height: 1.6;
}

/* --- S√©lecteur de mode --- */
.mode-select {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.6rem;
  margin: 2rem auto 0;
}
.mode-select button {
  background: #161616;
  border: 1px solid #333;
  color: #eee;
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
}
.mode-select button:hover {
  background: #262626;
  transform: translateY(-2px);
}
.mode-select button.active {
  background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
  border: none;
  color: #fff;
  transform: translateY(-2px);
}

/* --- Zone du jeu --- */
.game-container {
  background: #111;
  padding: 2.5rem 2rem;
  border-radius: 20px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.7);
  max-width: 500px;
  margin: 3rem auto;
  text-align: center;
  position: relative;
  border: 1px solid rgba(255,255,255,0.05);
  overflow: hidden;
  transition: transform 0.35s ease, box-shadow 0.35s ease;
}
.game-container.correct { border: 2px solid #2ecc71; box-shadow: 0 0 30px rgba(46,204,113,0.3); transform: scale(1.02); }
.game-container.wrong { border: 2px solid #e74c3c; animation: shake 0.35s; }

@keyframes shake {
  0%,100%{transform:translateX(0);}
  25%{transform:translateX(-6px);}
  75%{transform:translateX(6px);}
}

/* --- Affiche --- */
#movie-image {
  width: 100%;
  height: 420px;
  border-radius: 14px;
  object-fit: cover;
  filter: blur(12px) brightness(0.85);
  transition: filter 0.7s ease, transform 0.7s ease;
}
.reveal { filter: blur(0px) brightness(1.05); transform: scale(1.02); }

/* --- Input et Boutons --- */
#guess-input {
  width: 85%;
  padding: 0.9rem;
  border-radius: 8px;
  border: none;
  font-size: 1rem;
  text-align: center;
  background: #1e1e1e;
  color: #fff;
  outline: none;
  box-shadow: inset 0 0 8px rgba(255,255,255,0.05);
  margin-top: 1.5rem;
}
#guess-btn {
  background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 0.8rem 1.5rem;
  font-weight: bold;
  cursor: pointer;
  margin-top: 1rem;
  transition: background 0.3s ease, transform 0.2s ease;
}
#guess-btn:hover { transform: translateY(-3px); }

/* --- Timer circulaire --- */
.timer-circle {
  --size: 80px;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  position: absolute;
  top: 1rem;
  right: 1rem;
  display: flex;
  justify-content: center;
  align-items: center;
  background: conic-gradient(var(--accent-color) 360deg, #222 0deg);
  font-weight: bold;
  color: #fff;
  box-shadow: 0 0 12px rgba(255,255,255,0.1);
  transition: background 1s linear;
}
.timer-inner {
  background: #111;
  border-radius: 50%;
  width: 65px;
  height: 65px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* --- Infos et score --- */
.message {
  color: #fff;
  font-weight: bold;
  margin-top: 1rem;
  min-height: 1.5rem;
  text-shadow: 0 0 10px rgba(255,255,255,0.1);
}
.score, .hint {
  margin-top: 1rem;
  font-size: 0.95rem;
  color: #bbb;
}
.score span { color: var(--accent-color); }

/* --- Responsive --- */
@media(max-width:550px){
  #movie-image { height: 320px; }
  .page-title { font-size: 2.3rem; }
}
</style>
</head>
<body>

<main>
  <section class="page-intro-section">
    <h2 class="page-title">üé¨ Devine le Film !</h2>
    <p class="page-description">
      Trouvez le film √† partir de son affiche flout√©e avant la fin du chrono.<br>
      Plus la difficult√© monte, plus les affiches se compliquent.<br>
      Bonne chance, cin√©phile.
    </p>
  </section>

  <div class="mode-select">
    <button data-mode="easy" class="active">Facile</button>
    <button data-mode="medium">Moyen</button>
    <button data-mode="hard">Difficile</button>
    <button data-mode="cinephile">Cin√©phile</button>
    <button data-mode="marathon">Marathon</button>
  </div>

  <div class="game-container">
    <div class="timer-circle" id="timer">
      <div class="timer-inner">15</div>
    </div>
    <img id="movie-image" src="" alt="Affiche flout√©e du film">
    <input type="text" id="guess-input" placeholder="Tapez le nom du film...">
    <button id="guess-btn">Valider</button>
    <div class="message" id="message"></div>
    <div class="hint" id="hint"></div>
    <div class="score" id="score"></div>
  </div>

  <p style="text-align:center; font-size:0.8rem; margin-top:1rem; opacity:0.7;">
    ‚ö†Ô∏è Ce jeu utilise l‚ÄôAPI de <a href="https://www.themoviedb.org/" target="_blank" rel="noopener">TMDB</a> mais n‚Äôest pas affili√© √† TMDB.
  </p>
</main>

<footer>
  <div class="footer-content">
    <div class="footer-links">
      <a href="mentions_l√©gales.html">Mentions l√©gales</a>
      <a href="politique-de-confidentialit√©.html">Politique de confidentialit√©</a>
      <a href="contact.html">Contact</a>
    </div>
    <p>&copy; 2025 L'≈íil Critique. Tous droits r√©serv√©s.</p>
  </div>
</footer>

<script src="assets/js/header.js"></script>
<script>
const API_KEY = "c733ef0d6713d6a5b282beff57cd6343";
const BASE_URL = "https://api.themoviedb.org/3";
const IMG_URL = "https://image.tmdb.org/t/p/w500";

let movies = [];
let currentMovie, attempts, score = 0, combo = 0;
let timerInterval, timeLeft, currentMode = "easy";

const imgEl = document.getElementById("movie-image");
const msgEl = document.getElementById("message");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const timerInner = document.querySelector(".timer-inner");
const hintEl = document.getElementById("hint");
const container = document.querySelector(".game-container");

function getModeQuery(mode) {
  switch(mode) {
    case "easy": return "sort_by=popularity.desc&vote_count.gte=2000";
    case "medium": return "sort_by=popularity.desc&vote_count.gte=500&vote_count.lte=2000";
    case "hard": return "sort_by=vote_average.desc&vote_count.gte=200";
    case "cinephile": return "sort_by=vote_average.desc&vote_count.gte=50&vote_count.lte=200";
    case "marathon": return "sort_by=popularity.desc";
    default: return "sort_by=popularity.desc&vote_count.gte=2000";
  }
}

async function fetchMovies() {
  const query = getModeQuery(currentMode);
  const randomPage = Math.floor(Math.random() * 5) + 1;
  try {
    const res = await fetch(`${BASE_URL}/discover/movie?api_key=${API_KEY}&language=fr-FR&page=${randomPage}&${query}`);
    const data = await res.json();
    movies = data.results.filter(m => m.poster_path && m.title);
    newMovie();
  } catch {
    msgEl.textContent = "Erreur de chargement. R√©essaie.";
  }
}

function normalizeTitle(title) {
  return title.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9 ]/g, "")
    .trim();
}

function revealHint(movie) {
  const hints = [];
  if (movie.release_date) hints.push(`üìÖ ${movie.release_date.split("-")[0]}`);
  if (movie.original_language) hints.push(`üåç ${movie.original_language.toUpperCase()}`);
  if (movie.vote_average) hints.push(`‚≠ê ${movie.vote_average.toFixed(1)}/10`);
  hintEl.textContent = hints.join(" ‚Ä¢ ");
}

function newMovie() {
  clearInterval(timerInterval);
  if (!movies.length) return fetchMovies();

  currentMovie = movies[Math.floor(Math.random()*movies.length)];
  attempts = 4;
  timeLeft = 15;
  imgEl.src = IMG_URL + currentMovie.poster_path;
  imgEl.classList.remove("reveal");
  msgEl.textContent = "üß© Essaie de deviner !";
  revealHint(currentMovie);

  scoreEl.innerHTML = `Score : <span>${Math.floor(score)}</span> | Combo : ${combo}`;
  timerInner.textContent = timeLeft;
  updateTimerCircle();

  timerInterval = setInterval(() => {
    timeLeft--;
    timerInner.textContent = timeLeft;
    updateTimerCircle();
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      loseRound(`‚è∞ Temps √©coul√© ! C‚Äô√©tait ${currentMovie.title}`);
    }
  }, 1000);
}

function updateTimerCircle() {
  const percent = (timeLeft / 15) * 360;
  timerEl.style.background = `conic-gradient(var(--accent-color) ${percent}deg, #222 ${percent}deg)`;
}

document.getElementById("guess-btn").addEventListener("click", () => {
  const guess = normalizeTitle(document.getElementById("guess-input").value);
  if (!guess) return;
  const answer = normalizeTitle(currentMovie.title);

  if (answer.includes(guess) || guess.includes(answer)) winRound();
  else wrongAnswer();
});

function winRound() {
  clearInterval(timerInterval);
  combo++;
  score += 1 + (combo > 1 ? combo * 0.5 : 0);
  msgEl.textContent = `‚úÖ Bravo ! ${currentMovie.title}`;
  container.classList.add("correct");
  imgEl.classList.add("reveal");
  setTimeout(() => { container.classList.remove("correct"); newMovie(); }, 2000);
}

function wrongAnswer() {
  attempts--;
  container.classList.add("wrong");
  setTimeout(() => container.classList.remove("wrong"), 400);
  if (attempts > 0) msgEl.textContent = `‚ùå Faux. Il te reste ${attempts} essais.`;
  else loseRound(`üí• Perdu ! C‚Äô√©tait ${currentMovie.title}`);
}

function loseRound(text) {
  clearInterval(timerInterval);
  combo = 0;
  msgEl.textContent = text;
  imgEl.classList.add("reveal");
  setTimeout(newMovie, 2500);
}

document.querySelectorAll(".mode-select button").forEach(btn => {
  btn.addEventListener("click", () => {
    currentMode = btn.dataset.mode;
    document.querySelectorAll(".mode-select button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    score = 0; combo = 0;
    fetchMovies();
  });
});

window.onload = fetchMovies;
</script>
</body>
</html>
