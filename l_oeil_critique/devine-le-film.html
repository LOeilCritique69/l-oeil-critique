<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Mini-jeu cin√©ma - Devine le film √† partir de l'affiche, avec diff√©rents niveaux de difficult√©.">
<title>Devine le Film - L'≈íil Critique</title>
<link rel="icon" href="assets/img/logo_chef_doeuvre_processed_copy.jpg" type="image/jpeg">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/chef_d_oeuvre.css">
</head>
<body>

<!-- === HEADER ORIGINAL === -->
<header>
    <div class="header-content">
        <a href="../index.html" class="logo-link">
            <img src="assets/img/logo_chef_doeuvre_processed_copy.jpg" alt="Logo L'≈íil Critique" class="logo">
        </a>
        <h1 class="site-title"><a href="../index.html" class="site-title-link">L'≈íil Critique</a></h1>
        <nav class="main-nav">
            <a href="films.html">Films</a>
            <a href="series.html">S√©ries</a>
            <a href="actualit√©s.html">Actualit√©s</a>
            <a href="reviews.html">Reviews</a>
            <a href="bande-annonces.html">Bandes-Annonces</a>
            <a href="A_propos.html">√Ä Propos</a>
        </nav>
    </div>
</header>

<!-- === CONTENU DU JEU === -->
<main>
    <section class="page-intro-section">
        <h2 class="page-title">üé¨ Devine le Film !</h2>
        <p class="page-description">
            Trouvez le film √† partir de son affiche flout√©e avant la fin du chrono.  
            Plus la difficult√© augmente, plus les affiches seront retorses.  
            Bonne chance, cin√©phile.
        </p>
    </section>

    <!-- S√©lection du mode -->
    <div class="mode-select">
        <button data-mode="easy" class="active">Facile</button>
        <button data-mode="medium">Moyen</button>
        <button data-mode="hard">Difficile</button>
        <button data-mode="cinephile">Cin√©phile</button>
        <button data-mode="marathon">Marathon</button>
    </div>

    <!-- Zone de jeu -->
    <div class="game-container">
        <div class="timer-circle" id="timer">15</div>
        <img id="movie-image" src="" alt="Affiche flout√©e du film">
        <input type="text" id="guess-input" placeholder="Tapez le nom du film...">
        <button id="guess-btn">Valider</button>
        <div class="message" id="message"></div>
        <div class="hint" id="hint"></div>
        <div class="score" id="score"></div>
    </div>

    <p style="text-align:center; font-size:0.8rem; margin-top:1rem; opacity:0.7;">
        ‚ö†Ô∏è Ce jeu utilise l‚ÄôAPI de <a href="https://www.themoviedb.org/" target="_blank" rel="noopener">TMDB</a> mais n‚Äôest pas affili√© √† TMDB.
    </p>
</main>

<!-- === FOOTER ORIGINAL === -->
<footer>
    <div class="footer-content">
        <div class="footer-links">
            <a href="mentions_l√©gales.html">Mentions l√©gales</a>
            <a href="politique-de-confidentialit√©.html">Politique de confidentialit√©</a>
            <a href="contact.html">Contact</a>
        </div>
        <p>&copy; 2025 L'≈íil Critique. Tous droits r√©serv√©s.</p>
    </div>
</footer>

<!-- === STYLE DU JEU === -->
<style>
.game-container {
  background: rgba(20, 20, 20, 0.95);
  padding: 2rem;
  border-radius: 20px;
  box-shadow: 0 10px 35px rgba(0,0,0,0.7);
  text-align: center;
  max-width: 480px;
  margin: 2.5rem auto;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s ease;
}
.game-container.correct { border: 2px solid #2ecc71; transform: scale(1.03); }
.game-container.wrong { border: 2px solid #e74c3c; animation: shake 0.4s; }

@keyframes shake {
  0%,100%{transform:translateX(0);}
  25%{transform:translateX(-8px);}
  75%{transform:translateX(8px);}
}

#movie-image {
  width: 100%;
  height: 420px;
  object-fit: cover;
  border-radius: 12px;
  filter: blur(12px) brightness(0.9);
  margin-bottom: 1.2rem;
  transition: filter 0.6s ease, transform 0.6s ease;
}
.reveal { filter: blur(0px) brightness(1.05); transform: scale(1.02); }

input[type="text"] {
  width: 85%;
  padding: 0.7rem;
  border-radius: 8px;
  border: none;
  margin-bottom: 1rem;
  font-size: 1rem;
  text-align: center;
}
button {
  padding: 0.7rem 1.3rem;
  border: none;
  border-radius: 10px;
  background: linear-gradient(135deg, #2d7d46, #46a86f);
  color: #fff;
  cursor: pointer;
  font-weight: bold;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
}
button:hover { transform: scale(1.05); }

.message {
  color: #fff;
  margin-top: 1rem;
  font-weight: bold;
  min-height: 1.5rem;
  transition: opacity 0.3s ease;
}
.score, .timer, .hint {
  margin-top: 1rem;
  font-size: 1rem;
  font-weight: 600;
  color: #f1c40f;
}

/* --- Timer circulaire --- */
.timer-circle {
  width: 80px;
  height: 80px;
  border: 5px solid #444;
  border-radius: 50%;
  position: absolute;
  top: 1rem;
  right: 1rem;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  color: #f1c40f;
}

/* --- Modes --- */
.mode-select {
  margin: 1.5rem auto;
  display: flex;
  justify-content: center;
  gap: 0.6rem;
  flex-wrap: wrap;
}
.mode-select button {
  background: #333;
  color: #fff;
  border: 1px solid #555;
}
.mode-select button.active {
  background: linear-gradient(135deg, #2d7d46, #46a86f);
  border: none;
}
.hint {
  color: #aaa;
  font-style: italic;
}

@media(max-width:500px){
  #movie-image { height: 320px; }
}
</style>

<!-- === SCRIPT DU JEU === -->
<script>
const API_KEY = "c733ef0d6713d6a5b282beff57cd6343";
const BASE_URL = "https://api.themoviedb.org/3";
const IMG_URL = "https://image.tmdb.org/t/p/w500";

let movies = [];
let currentMovie, attempts, score = 0, combo = 0;
let timerInterval, timeLeft, currentMode = "easy";

const imgEl = document.getElementById("movie-image");
const msgEl = document.getElementById("message");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const hintEl = document.getElementById("hint");
const container = document.querySelector(".game-container");

// üîß Modes
function getModeQuery(mode) {
  switch(mode) {
    case "easy": return "sort_by=popularity.desc&vote_count.gte=2000";
    case "medium": return "sort_by=popularity.desc&vote_count.gte=500&vote_count.lte=2000";
    case "hard": return "sort_by=vote_average.desc&vote_count.gte=200";
    case "cinephile": return "sort_by=vote_average.desc&vote_count.gte=50&vote_count.lte=200";
    case "marathon": return "sort_by=popularity.desc";
    default: return "sort_by=popularity.desc&vote_count.gte=2000";
  }
}

// üß© R√©cup√©ration de films
async function fetchMovies() {
  const query = getModeQuery(currentMode);
  const randomPage = Math.floor(Math.random() * 5) + 1;
  try {
    const res = await fetch(`${BASE_URL}/discover/movie?api_key=${API_KEY}&language=fr-FR&page=${randomPage}&${query}`);
    const data = await res.json();
    movies = data.results.filter(m => m.poster_path && m.title);
    newMovie();
  } catch {
    msgEl.textContent = "Erreur de chargement. R√©essaie.";
  }
}

// üß† Nettoyage du titre
function normalizeTitle(title) {
  return title.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9 ]/g, "")
    .trim();
}

// üí° Indices
function revealHint(movie) {
  const hints = [];
  if (movie.release_date) hints.push(`üìÖ ${movie.release_date.split("-")[0]}`);
  if (movie.original_language) hints.push(`üåç ${movie.original_language.toUpperCase()}`);
  if (movie.vote_average) hints.push(`‚≠ê ${movie.vote_average.toFixed(1)}/10`);
  hintEl.textContent = hints.join(" ‚Ä¢ ");
}

// üîÑ Nouveau film
function newMovie() {
  clearInterval(timerInterval);
  if (!movies.length) return fetchMovies();

  currentMovie = movies[Math.floor(Math.random()*movies.length)];
  attempts = 4;
  timeLeft = 15;
  imgEl.src = IMG_URL + currentMovie.poster_path;
  imgEl.classList.remove("reveal");
  msgEl.textContent = "üß© Essaie de deviner !";
  revealHint(currentMovie);

  scoreEl.textContent = `Score : ${score} | Combo : ${combo}`;
  timerEl.textContent = timeLeft;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      loseRound(`‚è∞ Temps √©coul√© ! C‚Äô√©tait ${currentMovie.title}`);
    }
  }, 1000);
}

// ‚úÖ V√©rification
document.getElementById("guess-btn").addEventListener("click", () => {
  const guess = normalizeTitle(document.getElementById("guess-input").value);
  if (!guess) return;
  const answer = normalizeTitle(currentMovie.title);

  if (answer.includes(guess) || guess.includes(answer)) winRound();
  else wrongAnswer();
});

function winRound() {
  clearInterval(timerInterval);
  combo++;
  score += 1 + (combo > 1 ? combo * 0.5 : 0);
  msgEl.textContent = `‚úÖ Bravo ! ${currentMovie.title}`;
  container.classList.add("correct");
  imgEl.classList.add("reveal");
  setTimeout(() => {
    container.classList.remove("correct");
    newMovie();
  }, 2000);
}

function wrongAnswer() {
  attempts--;
  container.classList.add("wrong");
  setTimeout(() => container.classList.remove("wrong"), 400);
  if (attempts > 0) msgEl.textContent = `‚ùå Faux. Il te reste ${attempts} essais.`;
  else loseRound(`üí• Perdu ! C‚Äô√©tait ${currentMovie.title}`);
}

function loseRound(text) {
  clearInterval(timerInterval);
  combo = 0;
  msgEl.textContent = text;
  imgEl.classList.add("reveal");
  setTimeout(newMovie, 2500);
}

// üéÆ S√©lection du mode
document.querySelectorAll(".mode-select button").forEach(btn => {
  btn.addEventListener("click", () => {
    currentMode = btn.dataset.mode;
    document.querySelectorAll(".mode-select button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    score = 0; combo = 0;
    fetchMovies();
  });
});

window.onload = fetchMovies;
</script>

</body>
</html>
